@model Application.GameCQ.Battles.Queries.GetBattleUnitsQuery.BattleUnitsListViewModel
<title>Command</title>
<partial name="_WorldNavBar">

    <div class="fade-in aligncenter starting-div">
        <h1 style="text-align:center" class="item-padding">@Model.Hero.Name  vs  @Model.Enemy.Name</h1>
        <div>
            <img src="@Model.Hero.ImagePath" alt="Player" width="80" height="80" id="hero" />
            <img src="@Model.Enemy.ImagePath" alt="Enemy" style="padding-left:250px;" id="enemy" />
            <br />

            <progress id="playerDamage" value="@Model.Hero.CurrentAttackPower" hidden></progress>
            <progress id="enemyDamage" value="@Model.Enemy.CurrentAttackPower" hidden></progress>
            <br />
            <div>
                <progress class="player-healthBar" id="playerHealth" value="@(Model.Hero.CurrentHP + 1)" max="@Model.Hero.MaxHP"></progress>
                <progress class="healthBar" id="enemyHealth" value="@Model.Enemy.CurrentHP" max="@Model.Enemy.MaxHP"></progress>
                <br />
                <br />
                <progress class="player-manaBar" id="playerMana" value="@Model.Hero.CurrentMana" max="@Model.Hero.MaxMana"></progress>
                <progress class="manaBar" id="enemyMana" value="@Model.Enemy.CurrentMana" max="@Model.Enemy.MaxMana"></progress>
                <div class="item-padding"><hr /></div>
            </div>
            <div class="item-padding">
                <form method="post" data-ajax="true" data-ajax-method="post" data-ajax-url="/Battle/Command" data-ajax-complete="Action">
                    <select class="command" name="command">
                        <option value="Attack">Attack</option>
                        <option value="Defend">Defend</option>
                        <option value="Spell">Spell</option>
                    </select>
                    <div class="item-padding fade-in" hidden id="spells">
                        <select name="spellId">
                            @foreach (var spell in Model.Hero.Spells)
                            {
                                <option value="@spell.Id">@spell.Name</option>
                            }
                        </select>
                    </div>
                    <div class="item-padding">
                        <input type="submit" class="main-button" name="button" id="action" value="Action" />
                    </div>
                </form>
                <div class="item-padding">
                </div>
            </div>
        </div>
    </div>
    <partial name="_Footer">
        @section scripts
        {
            <script src="~/js/battle.js"></script>
            <script>
                Action = (data) => {
                    if (data.status == 200) {
                        let hero = data.responseJSON.battleUnits.hero;
                        let enemy = data.responseJSON.battleUnits.enemy;

                        document.getElementById('playerHealth').value = hero.currentHP;
                        document.getElementById('enemyHealth').value = enemy.currentHP;
                        document.getElementById('playerMana').value = hero.currentMana;
                        document.getElementById('enemyMana').value = enemy.currentMana;

                        if (hero.currentHP <= 0) {
                            window.location.href = "/Hero/Killed";
                        } else if (enemy.currentHP <= 0)
                        {
                            window.location.href = "/Battle/End";
                        }
                    }
                }

            </script>
        }
